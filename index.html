<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Web App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            color: var(--tg-theme-text-color);
            background: var(--tg-theme-bg-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 18px;
        }

        .button {
            background: var(--tg-theme-button-color);
            color: var(--tg-theme-button-text-color);
            border: none;
            font-size: 18px;
            padding: 10px 20px;
            cursor: pointer;
            margin: 10px;
        }

        #usercard {
            text-align: center;
            display: none;
        }

        #userAvatar {
            width: 80px; /* Ширина аватара */
            height: 80px; /* Высота аватара */
            border-radius: 50%; /* Классическая круглая форма */
            margin-bottom: 10px; /* Отступ снизу */
        }

        #balanceSection {
            text-align: center;
            display: none;
        }
    </style>
</head>
<body>
    <div id="usercard">
        <img id="userAvatar" src="" alt="Аватар пользователя">
    </div>
    <div id="balanceSection">
        <p>Баланс: <span id="balanceValue">0</span> монет</p>
        <button id="clickButton" class="button">Клик</button>
    </div>
    <button id="profileBtn" class="button">Профиль</button>

    <script>
        let tg = window.Telegram.WebApp;
        tg.expand();

        // Загружаем начальный баланс из localStorage
        let balance = localStorage.getItem('userBalance') ? parseInt(localStorage.getItem('userBalance')) : 0;
        document.getElementById("balanceValue").innerText = balance;

        // Функция для загрузки информации о пользователе
        function displayUserInfo() {
            let usercard = document.getElementById("usercard");
            usercard.innerHTML = ''; // Очищаем поле перед заполнением

            let avatar = document.getElementById("userAvatar");
            // Загружаем аватар из Telegram профиля
            avatar.src = tg.initDataUnsafe.user.photo_url || 'https://via.placeholder.com/80'; // Заглушка для отсутствующего аватара

            let profName = document.createElement('p');
            profName.innerText = `${tg.initDataUnsafe.user.first_name || ''} ${tg.initDataUnsafe.user.last_name || ''} (${tg.initDataUnsafe.user.username || 'N/A'})`;
            usercard.appendChild(avatar); // Добавляем аватар
            usercard.appendChild(profName);

            let userid = document.createElement('p');
            userid.innerText = `User ID: ${tg.initDataUnsafe.user.id || 'N/A'}`;
            usercard.appendChild(userid);
        }

        // Обработчик кнопки "Профиль"
        document.getElementById("profileBtn").addEventListener('click', function() {
            let usercard = document.getElementById("usercard");
            let balanceSection = document.getElementById("balanceSection");

            if (usercard.style.display === "none" || usercard.style.display === "") {
                usercard.style.display = "block";
                balanceSection.style.display = "block";
                displayUserInfo();
            } else {
                usercard.style.display = "none";
                balanceSection.style.display = "none";
            }
        });

        // Обработчик кнопки "Клик"
        document.getElementById("clickButton").addEventListener('click', function() {
            balance++;
            document.getElementById("balanceValue").innerText = balance;
            localStorage.setItem('userBalance', balance);
        });

        // Инициализация отображения начального баланса
        document.getElementById("balanceValue").innerText = balance;

    </script>
</body>
</html>
